<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="日本株専門の投資判断アプリ。ストップ高銘柄を自動取得し、AIが財務データ・ニュース材料を分析して買い/中立/売りの投資判断を提示します。">
  <title>投資判断AI</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
</head>

<body style="background-color: #0a0e1a; color: #e2e8f0; margin: 0;">

  <!-- ===== ヘッダー ===== -->
  <header class="app-header">
    <div class="header-inner">
      <div class="app-logo">
        <div class="logo-icon">📊</div>
        <div class="app-title">投資判断AI</div>
      </div>
      <div class="header-actions">
        <div class="date-badge" id="dateDisplay">--/--/--</div>
        <div class="model-badge" id="currentModelBadge" title="現在のモデル">🤖 gemini-2.0-flash</div>
        <button class="theme-toggle" id="themeToggleBtn" title="ライト/ダークモード切替" aria-label="テーマ切替"></button>
        <button class="btn btn-ghost btn-icon" id="settingsBtn" title="設定">⚙️</button>
      </div>

    </div>
  </header>

  <!-- ===== メインコンテンツ ===== -->
  <main class="app-main">

    <!-- アラートエリア -->
    <div id="alertArea"></div>

    <!-- ===== SEARCH: 任意の銘柄分析 ===== -->
    <section class="search-section">
      <div class="search-bar card">
        <div class="search-input-wrapper">
          <input type="text" id="customSearchInput" class="form-input" placeholder="銘柄コード(4桁) または 銘柄名を入力"
            autocomplete="off">
          <button id="clearSearchBtn" class="clear-btn" title="クリア">×</button>
        </div>
        <button class="btn btn-primary" id="customAnalyzeBtn">📊 銘柄を分析</button>
      </div>
    </section>

    <!-- ===== STEP 1: ストップ高銘柄 ===== -->
    <section class="stop-high-section">
      <div class="section-header">
        <div class="section-title">
          <span class="icon">🚀</span>
          本日のストップ高銘柄
          <span class="section-badge" id="stockCount">0</span>
        </div>
      </div>

      <!-- 取得バー -->
      <div class="fetch-bar">
        <div class="fetch-bar-text">
          <span id="fetchStatus">ストップ高銘柄を取得するにはボタンをクリックしてください</span>
        </div>
        <button class="btn btn-primary" id="fetchBtn">
          🔄 ストップ高銘柄を取得
        </button>
      </div>

      <!-- テーブルコンテナ -->
      <div class="card">
        <!-- ローディング -->
        <div class="loading-state" id="loadingState" style="display:none">
          <div class="spinner"></div>
          <div class="loading-text">Gemini AIがストップ高銘柄を検索中<span class="loading-dots"></span></div>
          <div style="font-size:11px;color:var(--text-muted)">Yahoo!ファイナンス・株探などから取得しています</div>
        </div>

        <!-- 空状態 -->
        <div class="empty-state" id="emptyState">
          <div class="empty-icon">📋</div>
          <div class="empty-text">
            「ストップ高銘柄を取得」ボタンをクリックして<br>本日のストップ高銘柄を取得してください
          </div>
        </div>

        <!-- テーブル -->
        <div class="table-wrapper" id="tableContainer" style="display:none">
          <table class="stock-table">
            <thead>
              <tr>
                <th>No</th>
                <th>銘柄コード</th>
                <th>銘柄名</th>
                <th>市場</th>
                <th>終値</th>
                <th>前日比</th>
                <th>材料・理由</th>
                <th>分析</th>
              </tr>
            </thead>
            <tbody id="stockTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- ソース表示エリア -->
      <div id="stockSources"></div>

      <!-- 分析案内 -->
      <div id="analyzeGuide" style="display:none;text-align:center;padding:12px;color:var(--text-muted);font-size:14px">
        👆 分析したい銘柄コードをクリックしてください
      </div>
    </section>

    <!-- ===== STEP 1.5: 急騰銘柄 ===== -->
    <section class="soaring-section">
      <div class="section-header">
        <div class="section-title">
          <span class="icon">📈</span>
          本日の急騰銘柄（+10%以上）
          <span class="section-badge" id="soaringCount">0</span>
        </div>
      </div>

      <!-- テーブルコンテナ -->
      <div class="card">
        <!-- 空状態（初期は非表示、データ取得後に判定） -->
        <div class="empty-state" id="soaringEmptyState" style="display:none; padding: 30px;">
          <div class="empty-text">
            データがありません
          </div>
        </div>

        <!-- テーブル -->
        <div class="table-wrapper" id="soaringTableContainer" style="display:none">
          <table class="stock-table">
            <thead>
              <tr>
                <th>No</th>
                <th>銘柄コード</th>
                <th>銘柄名</th>
                <th>市場</th>
                <th>終値</th>
                <th>前日比</th>
                <th>材料・理由</th>
                <th>分析</th>
              </tr>
            </thead>
            <tbody id="soaringTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ===== STEP 2: 銘柄分析レポート ===== -->
    <section class="report-section" id="reportSection">
      <div class="section-header">
        <div class="section-title">
          <span class="icon">📌</span>
          銘柄分析レポート
        </div>
      </div>

      <!-- レポートローディング -->
      <div class="loading-state" id="reportLoading" style="display:none">
        <div class="spinner"></div>
        <div class="loading-text">Gemini AIが銘柄を分析中<span class="loading-dots"></span></div>
        <div style="font-size:11px;color:var(--text-muted)">決算書・財務指標・ニュース材料を調査しています</div>
        <div style="font-size:11px;color:var(--text-muted);margin-top:4px">（30秒〜1分程度かかる場合があります）</div>
      </div>

      <!-- レポートコンテンツ -->
      <div id="reportContent"></div>
    </section>

  </main>

  <!-- ===== 設定モーダル ===== -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">⚙️ 設定</div>
        <button class="modal-close" id="closeModalBtn">✕</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="apiKeyInput">Gemini APIキー</label>
          <input type="password" class="form-input" id="apiKeyInput" placeholder="AIza..." autocomplete="off">
          <div class="form-hint">
            Google AI Studio（<a href="https://aistudio.google.com/app/apikey" target="_blank"
              rel="noopener">aistudio.google.com</a>）でAPIキーを取得してください。<br>
            キーはお使いのブラウザのローカルストレージに保存されます。外部サーバーには送信されません。
          </div>
        </div>

        <!-- モデル選択 -->
        <div class="form-group">
          <label class="form-label">使用モデル</label>
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <select class="form-input" id="modelSelect" style="flex:1">
              <option value="gemini-2.0-flash">gemini-2.0-flash ✓検索対応</option>
              <option value="gemini-1.5-flash">gemini-1.5-flash ✓検索対応</option>
              <option value="gemini-1.5-pro">gemini-1.5-pro ✓検索対応</option>
            </select>
            <button class="btn btn-ghost" id="fetchModelsBtn" style="white-space:nowrap;flex-shrink:0">
              🔄 モデルを検索
            </button>
          </div>
          <div id="modelStatus" style="font-size:11px;color:var(--text-muted);min-height:16px">
            「モデルを検索」ボタンでAPIキーで利用可能なモデルを自動取得できます
          </div>
          <div class="form-hint" style="margin-top:6px">
            ✓検索対応：Google検索でリアルタイムデータを取得できます（推奨）<br>
            △検索非対応：学習データのみで分析します
          </div>
        </div>

        <div class="alert alert-warning">
          <span class="alert-icon">⚠️</span>
          <span style="font-size:12px">
            検索対応モデルはGemini APIのGoogle Search grounding機能を使用します。
            APIの利用料金はGoogle AI Studioの料金体系に従います。
          </span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-ghost" id="cancelSettingsBtn">キャンセル</button>
        <button class="btn btn-primary" id="saveSettingsBtn">💾 保存</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>